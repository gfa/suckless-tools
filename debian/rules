#!/usr/bin/make -f

SHELL := sh -e

D := $(CURDIR)/debian/suckless-tools
TOOLS = $(shell ls | sed -e 's|debian||')
ALTERNATIVES = $(shell ls debian/local)

%:
	dh $@

override_dh_auto_clean:
	dh_auto_clean
	for TOOL in $(TOOLS); \
	do \
		make -C $${TOOL} clean; \
	done
	@diff -q tabbed/config.h tabbed/config.def.h && rm -f tabbed/config.h || true

override_dh_auto_build:
	for TOOL in $(TOOLS);\
	do \
		make -C $${TOOL}; \
	done

override_dh_auto_install:
	for TOOL in $(TOOLS); \
	do \
		$(MAKE) -C $${TOOL} DESTDIR=$(D) TERMINFO=$(D)/usr/share/terminfo PREFIX=/usr install; \
	done

	for ALTERNATIVE in $(ALTERNATIVES); \
	do \
		for patch in $(shell ls debian/local/$${ALTERNATIVE}/*); \
		do \
			patch -p1 < debian/local/$${ALTERNATIVE}/$${patch} -d $${ALTERNATIVE}; \
			make -C $${ALTERNATIVE};\
			cp -f $${ALTERNATIVE}/$${ALTERNATIVE} $(D)/$${patch}; \
			cp -f $${ALTERNATIVE}/$${ALTERNATIVE}.1 $(D)/usr/share/man/man1/$${patch}.1; \
		done \
	done

override_dh_installdocs:
	dh_installdocs
	for TOOL in $(TOOLS); \
	do \
		cp $${TOOL}/README $(D)/usr/share/doc/suckless-tools/README.$${TOOL}; \
	done

override_dh_fixperms:
	dh_fixperms -Xusr/bin/slock

get-orig-source:
	$(dir $(firstword $(MAKEFILE_LIST)))create_orig_source


